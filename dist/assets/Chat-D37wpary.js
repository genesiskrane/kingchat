import{_ as U}from"./SideBar-nTGxHR5D.js";import{_ as I,f as V,r as R,g as T,D as $,o as n,h as i,F as N,j as S,u as r,E as B,d as _,t as D,G as O,H as j,p as q,n as G,I as z,b as o,k as W,c as J,w as y,e as K,a as f,m as P}from"./index-DZUghzR5.js";import{_ as Q}from"./Messenger-IuRi5_DB.js";const M=h=>(q("data-v-96957755"),h=h(),G(),h),X={key:0,id:"unread-tag",class:"text-center"},Y=M(()=>_("span",{class:"text-xl underline"},"Unread Messages",-1)),Z=[Y],ee={class:"flex flex-row gap-1 float-right text-xs"},te={id:"time"},ae={key:0,id:"reciept",class:"grid items-center"},se={key:0,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ne=M(()=>_("path",{fill:"currentColor",stroke:"#43A047",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),ie=[ne],oe={key:1,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},re=M(()=>_("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),le=[re],ce={key:2,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},de=M(()=>_("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M21 7L9 19l-5.5-5.5l1.41-1.41L9 16.17L19.59 5.59z"},null,-1)),ue=[de],me={key:3,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},_e=j('<circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-96957755><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12" data-v-96957755></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-96957755></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-96957755><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12" data-v-96957755></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-96957755></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-96957755><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12" data-v-96957755></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-96957755></animate></circle>',3),ve=[_e],pe=["time"],fe={__name:"Bubbles",props:["chat"],setup(h,{expose:x}){const t=V(),{chat:a}=h,l=R(null);x({bubbleDiv:l});const c=t.user.uid,v=a._id.split(c).find(s=>s.length>0);let d;const p=T(()=>a.meta);let C=T(()=>{let s={};return s.read=a.messages.filter(u=>u.time<p.value[c].lastRead),s.unread=a.messages.filter(u=>u.time>p.value[c].lastRead),s});function b(){let u={root:null,rootMargin:`0px 0px -${l.value.parentElement.children[1].offsetHeight}px 0px`,threshold:0};d=new IntersectionObserver(L,u);let g=[],w=l.value.children;for(let e of w){const k=e.children[0].children[0].children[1].children[1];k.getAttribute("time")&&g.push(k)}g.forEach(e=>{e.getAttribute("time")>p.value[c].lastRead&&d.observe(e)})}$(()=>{new MutationObserver(()=>b()).observe(l.value,{childList:!0})});function m(s){return t.user.uid==s?"right":"left"}function L(s){s.forEach(u=>{if(u.isIntersecting){const g=u.target.getAttribute("time");g>p.value[c].lastRead&&(console.log("Sending Read Reciept"),t.sendReciept(a._id,{lastRead:g}),d.unobserve(u.target))}})}return(s,u)=>(n(),i("div",{id:"bubbleDiv",ref_key:"bubbleDiv",ref:l},[(n(!0),i(N,null,S(r(C),(g,w)=>(n(),i(N,{key:w},[w=="unread"&&r(C).length>0?(n(),i("div",X,Z)):B("",!0),(n(!0),i(N,null,S(r(C)[w],(e,k)=>(n(),i("div",{key:k,ref_for:!0,ref:w,class:"grid mx-2 my-4"},[_("div",{class:O(["bubble shadow-sm",{left:m(e.sender)=="left",right:m(e.sender)=="right"}])},[_("div",null,[_("div",null,D(e.text),1),_("div",ee,[_("div",te,D(r(t).formatTimeDisplay(e.time)),1),m(e.sender)=="right"?(n(),i("div",ae,[p.value[r(v)].lastRead>=e.time?(n(),i("svg",se,ie)):p.value[r(v)].lastDelivered>e.time?(n(),i("svg",oe,le)):p.value[r(c)].lastSent>e.time?(n(),i("svg",ce,ue)):p.value[r(c)].lastSent<e.time?(n(),i("svg",me,ve)):B("",!0)])):B("",!0),m(e.sender)=="left"?(n(),i("div",{key:1,time:e.time},null,8,pe)):B("",!0)])])],2)]))),128))],64))),128))],512))}},he=I(fe,[["__scopeId","data-v-96957755"]]),be={__name:"Chat",props:["active","to"],setup(h){const x=R(null),t=R(null),a=R(null);function l(){const c=a.value.widgetDiv.offsetHeight,v=x.value.offsetWidth;t.value.bubbleDiv.style.width=v+"px",t.value.bubbleDiv.style.marginBottom=c+"px",a.value.widgetDiv.style.margin="auto",a.value.widgetDiv.style.width=v+"px"}return $(()=>{l(),window.addEventListener("resize",l)}),z(()=>window.removeEventListener("resize",l)),(c,v)=>(n(),i("div",{class:"flex flex-col h-full",ref_key:"page",ref:x},[o(he,{chat:h.active,class:"w-full text-sm",ref_key:"chat",ref:t},null,8,["chat"]),o(Q,{class:"messenger w-full",to:h.to,ref_key:"widget",ref:a},null,8,["to"])],512))}},ge=I(be,[["__scopeId","data-v-7b4cbeef"]]),we={class:"text-xs"},Ce={__name:"Chat",setup(h){const x=R(!1),t=V(),a=K(),l=P(),c=a.query.origin;let v;switch(c){case"/home":v="recent";break;case"/chats":v="chats";break}let d=t.chats.find(b=>b.profile.username==a.params.username);if(!d){let{_id:b,profile:m}=t[v].find(L=>L.profile.username==a.params.username);d=t.createNewChat(b,m)}const p=W({type:"Chat",chatid:d._id});function C(){window.history.length>1?l.back():l.push({path:"/chats"})}return z(()=>{t.chats=t.chats.filter(b=>b.messages.length>0)}),(b,m)=>{const L=f("v-navigation-drawer"),s=f("v-icon"),u=f("v-app-bar-nav-icon"),g=f("v-img"),w=f("v-avatar"),e=f("v-app-bar-title"),k=f("v-app-bar"),F=f("v-container"),A=f("v-main"),H=f("v-app");return n(),J(H,null,{default:y(()=>[o(L,{modelValue:x.value,"onUpdate:modelValue":m[0]||(m[0]=E=>x.value=E)},{default:y(()=>[o(U)]),_:1},8,["modelValue"]),o(k,{elevation:2,color:"red-darken-1"},{default:y(()=>[o(u,{onClick:m[1]||(m[1]=E=>C())},{default:y(()=>[o(s,{icon:"mdi-keyboard-backspace"})]),_:1}),o(w,null,{default:y(()=>[o(g,{alt:r(d).profile.displayName,src:r(d).profile.photoURL},null,8,["alt","src"])]),_:1}),o(e,null,{default:y(()=>[_("span",null,D(r(d).profile.displayName),1),_("span",we," @"+D(r(d).profile.username),1)]),_:1})]),_:1}),o(A,null,{default:y(()=>[o(F,{class:"ma-0 pa-0 mx-auto h-full"},{default:y(()=>[o(ge,{active:r(d),to:p},null,8,["active","to"])]),_:1})]),_:1})]),_:1})}}};export{Ce as default};
