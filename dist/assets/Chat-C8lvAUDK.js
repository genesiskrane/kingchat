import{_ as U}from"./SideBar-DoS4Ie2m.js";import{_ as I,f as $,r as R,g as T,E as V,o as n,h as o,F as D,j as S,u as l,k as B,d as i,t as M,G as q,H as O,p as j,l as G,I as z,b as r,m as W,c as J,w as y,e as K,a as f,q as P}from"./index-DM4HTdBR.js";import{_ as Q}from"./Messenger-BWuVTg2a.js";const N=h=>(j("data-v-96957755"),h=h(),G(),h),X={key:0,id:"unread-tag",class:"text-center"},Y=N(()=>i("span",{class:"text-xl underline"},"Unread Messages",-1)),Z=[Y],ee={class:"flex flex-row gap-1 float-right text-xs"},te={id:"time"},ae={key:0,id:"reciept",class:"grid items-center"},se={key:0,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ne=N(()=>i("path",{fill:"currentColor",stroke:"#43A047",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),ie=[ne],oe={key:1,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},re=N(()=>i("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),le=[re],ce={key:2,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},de=N(()=>i("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M21 7L9 19l-5.5-5.5l1.41-1.41L9 16.17L19.59 5.59z"},null,-1)),ue=[de],me={key:3,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},_e=O('<circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-96957755><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12" data-v-96957755></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-96957755></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-96957755><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12" data-v-96957755></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-96957755></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-96957755><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12" data-v-96957755></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-96957755></animate></circle>',3),ve=[_e],pe=["time"],fe={__name:"Bubbles",props:["chat"],setup(h,{expose:x}){const t=$(),{chat:a}=h,c=R(null);x({bubbleDiv:c});const d=t.user.uid,v=a._id.split(d).find(s=>s.length>0);let u;const p=T(()=>a.meta);let C=T(()=>{let s={};return s.read=a.messages.filter(m=>m.time<p.value[d].lastRead),s.unread=a.messages.filter(m=>m.time>p.value[d].lastRead),s});function b(){let m={root:null,rootMargin:`0px 0px -${c.value.parentElement.children[1].offsetHeight}px 0px`,threshold:0};u=new IntersectionObserver(L,m);let g=[],w=c.value.children;for(let e of w){const k=e.children[0].children[0].children[1].children[1];k.getAttribute("time")&&g.push(k)}g.forEach(e=>{e.getAttribute("time")>p.value[d].lastRead&&u.observe(e)})}V(()=>{new MutationObserver(()=>b()).observe(c.value,{childList:!0})});function _(s){return t.user.uid==s?"right":"left"}function L(s){s.forEach(m=>{if(m.isIntersecting){const g=m.target.getAttribute("time");g>p.value[d].lastRead&&(console.log("Sending Read Reciept"),t.sendReciept(a._id,{lastRead:g}),u.unobserve(m.target))}})}return(s,m)=>(n(),o("div",{id:"bubbleDiv",ref_key:"bubbleDiv",ref:c},[(n(!0),o(D,null,S(l(C),(g,w)=>(n(),o(D,{key:w},[w=="unread"&&l(C).length>0?(n(),o("div",X,Z)):B("",!0),(n(!0),o(D,null,S(l(C)[w],(e,k)=>(n(),o("div",{key:k,ref_for:!0,ref:w,class:"grid mx-2 my-4"},[i("div",{class:q(["bubble shadow-sm",{left:_(e.sender)=="left",right:_(e.sender)=="right"}])},[i("div",null,[i("div",null,M(e.text),1),i("div",ee,[i("div",te,M(l(t).formatTimeDisplay(e.time)),1),_(e.sender)=="right"?(n(),o("div",ae,[p.value[l(v)].lastRead>=e.time?(n(),o("svg",se,ie)):p.value[l(v)].lastDelivered>e.time?(n(),o("svg",oe,le)):p.value[l(d)].lastSent>e.time?(n(),o("svg",ce,ue)):p.value[l(d)].lastSent<e.time?(n(),o("svg",me,ve)):B("",!0)])):B("",!0),_(e.sender)=="left"?(n(),o("div",{key:1,time:e.time},null,8,pe)):B("",!0)])])],2)]))),128))],64))),128))],512))}},he=I(fe,[["__scopeId","data-v-96957755"]]),be={__name:"Chat",props:["active","to"],setup(h){const x=R(null),t=R(null),a=R(null);function c(){const d=a.value.widgetDiv.offsetHeight,v=x.value.offsetWidth;t.value.bubbleDiv.style.width=v+"px",t.value.bubbleDiv.style.marginBottom=d+"px",a.value.widgetDiv.style.margin="auto",a.value.widgetDiv.style.width=v+"px"}return V(()=>{c(),window.addEventListener("resize",c)}),z(()=>window.removeEventListener("resize",c)),(d,v)=>(n(),o("div",{class:"flex flex-col h-full",ref_key:"page",ref:x},[r(he,{chat:h.active,class:"w-full text-sm",ref_key:"chat",ref:t},null,8,["chat"]),r(Q,{class:"messenger w-full",to:h.to,ref_key:"widget",ref:a},null,8,["to"])],512))}},ge=I(be,[["__scopeId","data-v-7b4cbeef"]]),we=i("br",null,null,-1),ye={class:"text-xs"},Le={__name:"Chat",setup(h){const x=R(!1),t=$(),a=K(),c=P(),d=a.query.origin;let v;switch(d){case"/home":v="recent";break;case"/chats":v="chats";break}let u=t.chats.find(b=>b.profile.username==a.params.username);if(!u){let{_id:b,profile:_}=t[v].find(L=>L.profile.username==a.params.username);u=t.createNewChat(b,_)}const p=W({type:"Chat",chatid:u._id});function C(){window.history.length>1?c.back():c.push({path:"/chats"})}return z(()=>{t.chats=t.chats.filter(b=>b.messages.length>0)}),(b,_)=>{const L=f("v-navigation-drawer"),s=f("v-icon"),m=f("v-app-bar-nav-icon"),g=f("v-img"),w=f("v-avatar"),e=f("v-app-bar-title"),k=f("v-app-bar"),F=f("v-container"),A=f("v-main"),H=f("v-app");return n(),J(H,null,{default:y(()=>[r(L,{modelValue:x.value,"onUpdate:modelValue":_[0]||(_[0]=E=>x.value=E)},{default:y(()=>[r(U)]),_:1},8,["modelValue"]),r(k,{elevation:2,color:"red-darken-1"},{default:y(()=>[r(m,{onClick:_[1]||(_[1]=E=>C())},{default:y(()=>[r(s,{icon:"mdi-keyboard-backspace"})]),_:1}),r(w,null,{default:y(()=>[r(g,{alt:l(u).profile.displayName,src:l(u).profile.photoURL},null,8,["alt","src"])]),_:1}),r(e,null,{default:y(()=>[i("div",null,[i("p",null,[i("span",null,M(l(u).profile.displayName),1),we,i("span",ye,"@"+M(l(u).profile.username),1)])])]),_:1})]),_:1}),r(A,null,{default:y(()=>[r(F,{class:"ma-0 pa-0 mx-auto h-full"},{default:y(()=>[r(ge,{active:l(u),to:p},null,8,["active","to"])]),_:1})]),_:1})]),_:1})}}};export{Le as default};
