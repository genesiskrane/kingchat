import{_ as H}from"./SideBar-CvNFnTi_.js";import{u as I,r as L,l as E,H as $,o as s,f as r,F as N,m as S,d as n,h as R,e as i,t as B,I as U,J as j,p as O,n as q,L as V,b as l,s as J,c as W,w as y,j as G,a as p,D as K,k as P}from"./index-nPxo57EI.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Q}from"./Messenger-B0okRMFU.js";const D=h=>(O("data-v-8e2f16ff"),h=h(),q(),h),X={key:0,id:"unread-tag",class:"text-center"},Y=D(()=>i("span",{class:"text-xl underline"},"Unread Messages",-1)),Z=[Y],ee={class:"flex flex-row gap-1 float-right text-xs"},te={id:"time"},ae={key:0,id:"reciept",class:"grid items-center"},se={key:0,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ne=D(()=>i("path",{fill:"currentColor",stroke:"#43A047",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),ie=[ne],oe={key:1,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},re=D(()=>i("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),le=[re],ce={key:2,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},de=D(()=>i("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M21 7L9 19l-5.5-5.5l1.41-1.41L9 16.17L19.59 5.59z"},null,-1)),ue=[de],fe={key:3,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},me=j('<circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-8e2f16ff><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12" data-v-8e2f16ff></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-8e2f16ff></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-8e2f16ff><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12" data-v-8e2f16ff></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-8e2f16ff></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-8e2f16ff><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12" data-v-8e2f16ff></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-8e2f16ff></animate></circle>',3),_e=[me],ve=["time"],pe={__name:"Bubbles",props:["chat"],setup(h,{expose:k}){const f=I(),{chat:t}=h,o=L(null);k({bubbleDiv:o});const c=f.user.uid,m=t._id.split(c).find(a=>a.length>0);let d;const _=E(()=>t.meta);let v=E(()=>{let a={};return a.read=t.messages.filter(u=>u.time<_.value[c].lastRead),a.unread=t.messages.filter(u=>u.time>_.value[c].lastRead),a});function b(){let u={root:null,rootMargin:`0px 0px -${o.value.parentElement.children[1].offsetHeight}px 0px`,threshold:0};d=new IntersectionObserver(M,u);let w=[],x=o.value.children;for(let e of x){const C=e.children[0].children[0].children[1].children[1];C.getAttribute("time")&&w.push(C)}w.forEach(e=>{e.getAttribute("time")>_.value[c].lastRead&&d.observe(e)})}$(()=>{new MutationObserver(()=>b()).observe(o.value,{childList:!0})});function g(a){return f.user.uid==a?"right":"left"}function M(a){a.forEach(u=>{if(u.isIntersecting){const w=u.target.getAttribute("time");w>_.value[c].lastRead&&(console.log("Sending Read Reciept"),f.sendReciept(t._id,{lastRead:w}),d.unobserve(u.target))}})}return(a,u)=>(s(),r("div",{id:"bubbleDiv",ref_key:"bubbleDiv",ref:o},[(s(!0),r(N,null,S(n(v),(w,x)=>(s(),r(N,{key:x},[x=="unread"&&n(v).length>0?(s(),r("div",X,Z)):R("",!0),(s(!0),r(N,null,S(n(v)[x],(e,C)=>(s(),r("div",{key:C,ref_for:!0,ref:x,class:"grid mx-2 my-4"},[i("div",{class:U(["bubble shadow-sm",{left:g(e.sender)=="left",right:g(e.sender)=="right"}])},[i("div",null,[i("div",null,B(e.text),1),i("div",ee,[i("div",te,B(n(f).formatTimeDisplay(e.time)),1),g(e.sender)=="right"?(s(),r("div",ae,[_.value[n(m)].lastRead>=e.time?(s(),r("svg",se,ie)):_.value[n(m)].lastDelivered>e.time?(s(),r("svg",oe,le)):_.value[n(c)].lastSent>e.time?(s(),r("svg",ce,ue)):_.value[n(c)].lastSent<e.time?(s(),r("svg",fe,_e)):R("",!0)])):R("",!0),g(e.sender)=="left"?(s(),r("div",{key:1,time:e.time},null,8,ve)):R("",!0)])])],2)]))),128))],64))),128))],512))}},he=z(pe,[["__scopeId","data-v-8e2f16ff"]]),be={__name:"Chat",props:["active","to"],setup(h){const k=L(null),f=L(null),t=L(null);function o(){const c=t.value.widgetDiv.offsetHeight,m=k.value.offsetWidth;f.value.bubbleDiv.style.width=m+"px",f.value.bubbleDiv.style.marginBottom=c+"px",t.value.widgetDiv.style.margin="auto",t.value.widgetDiv.style.width=m+"px"}return $(()=>{o(),window.addEventListener("resize",o)}),V(()=>window.removeEventListener("resize",o)),(c,m)=>(s(),r("div",{class:"flex flex-col h-full",ref_key:"page",ref:k},[l(he,{chat:h.active,class:"w-full text-sm",ref_key:"chat",ref:f},null,8,["chat"]),l(Q,{class:"messenger w-full",to:h.to,ref_key:"widget",ref:t},null,8,["to"])],512))}},ge=z(be,[["__scopeId","data-v-6f5585ab"]]),we=i("br",null,null,-1),xe={class:"text-xs"},Re={__name:"Chat",setup(h){const k=L(!1),{back:f}=K("app"),t=I(),o=G();P();const c=o.query.origin;let m;switch(c){case"/home":m="recent";break;case"/chats":m="chats";break}let d=t.chats.find(v=>v.profile.username==o.params.username);if(!d){let{_id:v,profile:b}=t[m].find(g=>g.profile.username==o.params.username);d=t.createNewChat(v,b)}const _=J({type:"Chat",chatid:d._id});return V(()=>{t.chats=t.chats.filter(v=>v.messages.length>0)}),(v,b)=>{const g=p("v-navigation-drawer"),M=p("v-icon"),a=p("v-app-bar-nav-icon"),u=p("v-img"),w=p("v-avatar"),x=p("v-app-bar-title"),e=p("v-app-bar"),C=p("v-container"),F=p("v-main"),A=p("v-app");return s(),W(A,null,{default:y(()=>[l(g,{modelValue:k.value,"onUpdate:modelValue":b[0]||(b[0]=T=>k.value=T)},{default:y(()=>[l(H)]),_:1},8,["modelValue"]),l(e,{elevation:2,color:"red-darken-1"},{default:y(()=>[l(a,{onClick:b[1]||(b[1]=T=>n(f)())},{default:y(()=>[l(M,{icon:"mdi-keyboard-backspace"})]),_:1}),l(w,null,{default:y(()=>[l(u,{alt:n(d).profile.displayName,src:n(d).profile.photoURL},null,8,["alt","src"])]),_:1}),l(x,null,{default:y(()=>[i("div",null,[i("p",null,[i("span",null,B(n(d).profile.displayName),1),we,i("span",xe,"@"+B(n(d).profile.username),1)])])]),_:1})]),_:1}),l(F,null,{default:y(()=>[l(C,{class:"ma-0 pa-0 mx-auto h-full"},{default:y(()=>[l(ge,{active:n(d),to:_},null,8,["active","to"])]),_:1})]),_:1})]),_:1})}}};export{Re as default};
