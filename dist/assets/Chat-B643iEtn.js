import{_ as U}from"./SideBar-y4cf8YDq.js";import{h as I,r as R,j as E,G as $,o as n,k as i,F as D,l as S,u as l,m as B,d as o,t as M,H as q,I as O,p as j,n as G,J as V,b as r,q as J,c as W,w as y,f as K,a as p,g as P}from"./index-DxFlzq2_.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Q}from"./Messenger-CO5FFM2v.js";const N=h=>(j("data-v-8e2f16ff"),h=h(),G(),h),X={key:0,id:"unread-tag",class:"text-center"},Y=N(()=>o("span",{class:"text-xl underline"},"Unread Messages",-1)),Z=[Y],ee={class:"flex flex-row gap-1 float-right text-xs"},te={id:"time"},ae={key:0,id:"reciept",class:"grid items-center"},se={key:0,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ne=N(()=>o("path",{fill:"currentColor",stroke:"#43A047",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),oe=[ne],ie={key:1,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},re=N(()=>o("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),le=[re],ce={key:2,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},de=N(()=>o("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M21 7L9 19l-5.5-5.5l1.41-1.41L9 16.17L19.59 5.59z"},null,-1)),ue=[de],fe={key:3,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},me=O('<circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-8e2f16ff><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12" data-v-8e2f16ff></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-8e2f16ff></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-8e2f16ff><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12" data-v-8e2f16ff></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-8e2f16ff></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-8e2f16ff><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12" data-v-8e2f16ff></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-8e2f16ff></animate></circle>',3),_e=[me],ve=["time"],pe={__name:"Bubbles",props:["chat"],setup(h,{expose:x}){const t=I(),{chat:a}=h,c=R(null);x({bubbleDiv:c});const d=t.user.uid,_=a._id.split(d).find(s=>s.length>0);let u;const v=E(()=>a.meta);let C=E(()=>{let s={};return s.read=a.messages.filter(f=>f.time<v.value[d].lastRead),s.unread=a.messages.filter(f=>f.time>v.value[d].lastRead),s});function b(){let f={root:null,rootMargin:`0px 0px -${c.value.parentElement.children[1].offsetHeight}px 0px`,threshold:0};u=new IntersectionObserver(L,f);let g=[],w=c.value.children;for(let e of w){const k=e.children[0].children[0].children[1].children[1];k.getAttribute("time")&&g.push(k)}g.forEach(e=>{e.getAttribute("time")>v.value[d].lastRead&&u.observe(e)})}$(()=>{new MutationObserver(()=>b()).observe(c.value,{childList:!0})});function m(s){return t.user.uid==s?"right":"left"}function L(s){s.forEach(f=>{if(f.isIntersecting){const g=f.target.getAttribute("time");g>v.value[d].lastRead&&(console.log("Sending Read Reciept"),t.sendReciept(a._id,{lastRead:g}),u.unobserve(f.target))}})}return(s,f)=>(n(),i("div",{id:"bubbleDiv",ref_key:"bubbleDiv",ref:c},[(n(!0),i(D,null,S(l(C),(g,w)=>(n(),i(D,{key:w},[w=="unread"&&l(C).length>0?(n(),i("div",X,Z)):B("",!0),(n(!0),i(D,null,S(l(C)[w],(e,k)=>(n(),i("div",{key:k,ref_for:!0,ref:w,class:"grid mx-2 my-4"},[o("div",{class:q(["bubble shadow-sm",{left:m(e.sender)=="left",right:m(e.sender)=="right"}])},[o("div",null,[o("div",null,M(e.text),1),o("div",ee,[o("div",te,M(l(t).formatTimeDisplay(e.time)),1),m(e.sender)=="right"?(n(),i("div",ae,[v.value[l(_)].lastRead>=e.time?(n(),i("svg",se,oe)):v.value[l(_)].lastDelivered>e.time?(n(),i("svg",ie,le)):v.value[l(d)].lastSent>e.time?(n(),i("svg",ce,ue)):v.value[l(d)].lastSent<e.time?(n(),i("svg",fe,_e)):B("",!0)])):B("",!0),m(e.sender)=="left"?(n(),i("div",{key:1,time:e.time},null,8,ve)):B("",!0)])])],2)]))),128))],64))),128))],512))}},he=z(pe,[["__scopeId","data-v-8e2f16ff"]]),be={__name:"Chat",props:["active","to"],setup(h){const x=R(null),t=R(null),a=R(null);function c(){const d=a.value.widgetDiv.offsetHeight,_=x.value.offsetWidth;t.value.bubbleDiv.style.width=_+"px",t.value.bubbleDiv.style.marginBottom=d+"px",a.value.widgetDiv.style.margin="auto",a.value.widgetDiv.style.width=_+"px"}return $(()=>{c(),window.addEventListener("resize",c)}),V(()=>window.removeEventListener("resize",c)),(d,_)=>(n(),i("div",{class:"flex flex-col h-full",ref_key:"page",ref:x},[r(he,{chat:h.active,class:"w-full text-sm",ref_key:"chat",ref:t},null,8,["chat"]),r(Q,{class:"messenger w-full",to:h.to,ref_key:"widget",ref:a},null,8,["to"])],512))}},ge=z(be,[["__scopeId","data-v-6f5585ab"]]),we=o("br",null,null,-1),ye={class:"text-xs"},Re={__name:"Chat",setup(h){const x=R(!1),t=I(),a=K(),c=P(),d=a.query.origin;let _;switch(d){case"/home":_="recent";break;case"/chats":_="chats";break}let u=t.chats.find(b=>b.profile.username==a.params.username);if(!u){let{_id:b,profile:m}=t[_].find(L=>L.profile.username==a.params.username);u=t.createNewChat(b,m)}const v=J({type:"Chat",chatid:u._id});function C(){window.history.length>1?c.back():c.push({path:"/chats"})}return V(()=>{t.chats=t.chats.filter(b=>b.messages.length>0)}),(b,m)=>{const L=p("v-navigation-drawer"),s=p("v-icon"),f=p("v-app-bar-nav-icon"),g=p("v-img"),w=p("v-avatar"),e=p("v-app-bar-title"),k=p("v-app-bar"),F=p("v-container"),A=p("v-main"),H=p("v-app");return n(),W(H,null,{default:y(()=>[r(L,{modelValue:x.value,"onUpdate:modelValue":m[0]||(m[0]=T=>x.value=T)},{default:y(()=>[r(U)]),_:1},8,["modelValue"]),r(k,{elevation:2,color:"red-darken-1"},{default:y(()=>[r(f,{onClick:m[1]||(m[1]=T=>C())},{default:y(()=>[r(s,{icon:"mdi-keyboard-backspace"})]),_:1}),r(w,null,{default:y(()=>[r(g,{alt:l(u).profile.displayName,src:l(u).profile.photoURL},null,8,["alt","src"])]),_:1}),r(e,null,{default:y(()=>[o("div",null,[o("p",null,[o("span",null,M(l(u).profile.displayName),1),we,o("span",ye,"@"+M(l(u).profile.username),1)])])]),_:1})]),_:1}),r(A,null,{default:y(()=>[r(F,{class:"ma-0 pa-0 mx-auto h-full"},{default:y(()=>[r(ge,{active:l(u),to:v},null,8,["active","to"])]),_:1})]),_:1})]),_:1})}}};export{Re as default};
