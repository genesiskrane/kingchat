import{_ as z}from"./SideBar-S3KwSMrO.js";import{_ as V,f as $,r as k,g as D,D as F,o as t,h as o,F as T,j as E,E as L,u as i,d as l,t as B,G as A,H as U,p as H,n as j,b as n,k as I,c as q,w as h,e as G,a as p}from"./index-B75tFWvR.js";import{_ as J}from"./Messenger-BsTEnBZ9.js";const M=u=>(H("data-v-31e51ff2"),u=u(),j(),u),O={key:0,id:"unread-tag",class:"text-center"},K=M(()=>l("span",{class:"text-xl underline"},"Unread Messages",-1)),P=[K],Q={class:"flex flex-row gap-1 float-right text-xs"},W={id:"time"},X={key:0,id:"reciept",class:"grid items-center"},Y={key:0,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},Z=M(()=>l("path",{fill:"currentColor",stroke:"#43A047",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),ee=[Z],te={key:1,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ae=M(()=>l("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M.41 13.41L6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17L7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42l-6.35 6.35l1.42 1.41z"},null,-1)),oe=[ae],se={key:2,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},ne=M(()=>l("path",{fill:"currentColor",stroke:"#ECEFF1",d:"M21 7L9 19l-5.5-5.5l1.41-1.41L9 16.17L19.59 5.59z"},null,-1)),re=[ne],ie={key:3,xmlns:"http://www.w3.org/2000/svg",style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24"},le=U('<circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-31e51ff2><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12" data-v-31e51ff2></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-31e51ff2></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-31e51ff2><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12" data-v-31e51ff2></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-31e51ff2></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0" data-v-31e51ff2><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12" data-v-31e51ff2></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0" data-v-31e51ff2></animate></circle>',3),ce=[le],de=["time"],ue={__name:"Bubbles",props:["chat"],setup(u,{expose:_}){const m=$(),{chat:r}=u,w=k(null);_({bubbleDiv:w});const s=m.user.uid,v=r._id.split(s).find(e=>e.length>0),c=D(()=>r.meta);console.log(c.value[s]);let y=D(()=>{let e={};return e.read=r.messages.filter(f=>f.time<c.value[s].lastRead),e.unread=r.messages.filter(f=>f.time>c.value[s].lastRead),e}),d=k([]),N={root:null,rootMargin:"0px",threshold:0},R=new IntersectionObserver(S,N);F(()=>{d.value=d.value.map(e=>e.children[0].children[0].children[1].children[1]),d.value=d.value.filter(e=>e.getAttribute("time")),d.value.forEach(e=>{console.log(e),R.observe(e)})});function g(e){return m.user.uid==e?"right":"left"}function S(e){e.forEach(f=>{if(console.log("entry"),f.isIntersecting){const x=f.target.getAttribute("time");console.log("read"),x>c.value[s].lastRead&&(console.log("Sending Read Reciept"),m.sendReciept(r._id,{lastRead:x}))}})}return(e,f)=>(t(),o("div",{ref_key:"bubbleDiv",ref:w},[(t(!0),o(T,null,E(i(y),(x,b)=>(t(),o(T,{key:b},[b=="unread"?(t(),o("div",O,P)):L("",!0),(t(!0),o(T,null,E(i(y)[b],(a,C)=>(t(),o("div",{key:C,ref_for:!0,ref:b,class:"grid mx-2 my-4"},[l("div",{class:A(["bubble shadow-sm",{left:g(a.sender)=="left",right:g(a.sender)=="right"}])},[l("div",null,[l("div",null,B(a.text),1),l("div",Q,[l("div",W,B(i(m).formatTimeDisplay(a.time)),1),g(a.sender)=="right"?(t(),o("div",X,[c.value[i(v)].lastRead>=a.time?(t(),o("svg",Y,ee)):c.value[i(s)].lastDelivered>a.time?(t(),o("svg",te,oe)):c.value[i(s)].lastSent>a.time?(t(),o("svg",se,re)):c.value[i(s)].lastSent<a.time?(t(),o("svg",ie,ce)):L("",!0)])):L("",!0),g(a.sender)=="left"?(t(),o("div",{key:1,time:a.time},null,8,de)):L("",!0)])])],2)]))),128))],64))),128))],512))}},_e=V(ue,[["__scopeId","data-v-31e51ff2"]]),me={class:"flex flex-col"},ve={__name:"Chat",props:["active","to"],setup(u){const _=k(null),m=k(null);return F(()=>{let r=m.value.widgetDiv.offsetHeight;_.value.bubbleDiv.style.marginBottom=r+"px"}),(r,w)=>(t(),o("div",me,[n(_e,{chat:u.active,class:"text-sm",ref_key:"chat",ref:_},null,8,["chat"]),n(J,{class:"messenger",to:u.to,ref_key:"widget",ref:m},null,8,["to"])]))}},fe=V(ve,[["__scopeId","data-v-52b796d7"]]),pe={class:"text-xs"},we={__name:"Chat",setup(u){const _=k(!1),m=$(),r=G(),w=r.query.origin;let s;switch(w){case"/home":s="recent";break;case"/chats":s="chats";break}let v=I(m[s].find(y=>y.profile.username==r.params.username));const c=I({type:"Chat",chatid:v._id||v.chatid});return console.log(v),(y,d)=>{const N=p("v-navigation-drawer"),R=p("v-app-bar-nav-icon"),g=p("v-img"),S=p("v-avatar"),e=p("v-app-bar-title"),f=p("v-app-bar"),x=p("v-container"),b=p("v-main"),a=p("v-app");return t(),q(a,null,{default:h(()=>[n(N,{modelValue:_.value,"onUpdate:modelValue":d[0]||(d[0]=C=>_.value=C)},{default:h(()=>[n(z)]),_:1},8,["modelValue"]),n(f,{elevation:2,color:"red-darken-1"},{default:h(()=>[n(R,{onClick:d[1]||(d[1]=C=>_.value=!_.value)}),n(S,null,{default:h(()=>[n(g,{alt:"John",src:i(v).profile.photoURL},null,8,["src"])]),_:1}),n(e,null,{default:h(()=>[l("span",null,B(i(v).profile.displayName),1),l("span",pe," @"+B(i(v).profile.username),1)]),_:1})]),_:1}),n(b,null,{default:h(()=>[n(x,{class:"ma-0 pa-0 mx-auto"},{default:h(()=>[n(fe,{active:i(v),to:c},null,8,["active","to"])]),_:1})]),_:1})]),_:1})}}};export{we as default};
